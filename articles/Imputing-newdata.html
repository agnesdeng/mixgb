<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Imputing newdata with a saved mixgb imputer • mixgb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Imputing newdata with a saved mixgb imputer">
<link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mixgb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Imputing-newdata.html">Imputing newdata with a saved mixgb imputer</a></li>
    <li><a class="dropdown-item" href="../articles/Using-mixgb.html">mixgb: Multiple Imputation Through XGBoost</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/agnesdeng/mixgb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Imputing newdata with a saved mixgb imputer</h1>
                        <h4 data-toc-skip class="author">Yongshi
Deng</h4>
            
            <h4 data-toc-skip class="date">2026-01-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/agnesdeng/mixgb/blob/HEAD/vignettes/Imputing-newdata.Rmd" class="external-link"><code>vignettes/Imputing-newdata.Rmd</code></a></small>
      <div class="d-none name"><code>Imputing-newdata.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="impute-new-unseen-data-using-a-saved-imputer-object">Impute new unseen data using a saved imputer object<a class="anchor" aria-label="anchor" href="#impute-new-unseen-data-using-a-saved-imputer-object"></a>
</h2>
<p>To demonstrate how to impute new data using a saved imputer, we first
split the <code>newborn</code> dataset into training data and test
data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2026</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">newborn</span><span class="op">)</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">0.7</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">newborn</span><span class="op">[</span><span class="va">idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">newborn</span><span class="op">[</span><span class="op">-</span><span class="va">idx</span>, <span class="op">]</span></span></code></pre></div>
<p>Next, we impute the training data using <code><a href="../reference/mixgb.html">mixgb()</a></code>. This
allows us to generate <code>m</code> imputed datasets and save the
corresponding imputation models by setting
<code>save.models = TRUE</code>. By default, models for all variables
with missing values in the training data are saved
(<code>save.vars = NULL</code>).</p>
<p>If the new or unseen data may contain missing values in additional
variables, users can save models for all variables by setting
<code>save.vars = colnames(train_data)</code>. This can be
time-consuming, as a model needs to be trained and saved for each
variable. When users are confident that only certain variables will have
missing values in future data, it is more efficient to specify only
those variables in <code>save.vars</code>.</p>
<p>To save the imputer object, specify a local directory using the
<code>save.models.folder</code> argument in <code><a href="../reference/mixgb.html">mixgb()</a></code>. In the
backend, models are saved in JSON format via <code>xgb.save()</code>.
This approach, recommended by XGBoost, is preferred over directly saving
the XGBoost models with <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> because it ensures
compatibility with future XGBoost releases.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a temporary folder</span></span>
<span><span class="va">tmp_folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mixgb_models"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tmp_folder</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># obtain m imputed datasets for train_data and save imputation models</span></span>
<span><span class="va">mixgb_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixgb.html">mixgb</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">train_data</span>, m <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  save.models <span class="op">=</span> <span class="cn">TRUE</span>, save.models.folder <span class="op">=</span> <span class="va">tmp_folder</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">mixgb_obj</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp_folder</span>, <span class="st">"mixgb_imputer.rds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If users specify the <code>save.models.folder</code>, the return
object will include the following:</p>
<ul>
<li><p><code>imputed_data</code>: a list of <code>m</code> imputed
datasets for training data</p></li>
<li><p><code>XGB.models</code>: a list of directories of <code>m</code>
sets of XGBoost models for variables specified in
<code>save.vars</code>.</p></li>
<li><p><code>params</code>: a list of parameters that are required for
imputing new data using <code><a href="../reference/impute_new.html">impute_new()</a></code> later on.</p></li>
<li><p><code>XGB.save</code> : a parameter indicates whether
<code>XGB.models</code> are the saved models or the directories for the
saved models.</p></li>
</ul>
<p>As the <code>mixgb_obj</code> does not contain the models themselves,
users need not worry about saving this object via
<code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code>. For later use, one can load the object into R
and impute new data.</p>
<p>To impute new data with this saved imputer object, we can use the
<code><a href="../reference/impute_new.html">impute_new()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixgb_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp_folder</span>, <span class="st">"mixgb_imputer.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">test_imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_new.html">impute_new</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">mixgb_obj</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></span></code></pre></div>
<p>Users can decide whether to perform initial imputation on new data.
By default, the training data is used to impute missing values in the
new dataset initially (<code>initial.newdata = FALSE</code>). After this
step, the missing values in the new data are imputed using the saved
models from the imputer object. This approach is considerably faster, as
it avoids retraining the imputation models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_new.html">impute_new</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">mixgb_obj</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></span></code></pre></div>
<p>When predictive mean matching (PMM) is used in <code><a href="../reference/mixgb.html">mixgb()</a></code>,
predicted values of missing entries in the new dataset will be matched
with donors from the training data. Users can also specify the number of
donors for PMM. The default setting <code>pmm.k = NULL</code> indicates
that the <code>pmm.k</code> value from the training object will be
inherited.</p>
<p>Similarly, the number of imputed datasets for the new data can be set
via <code>m</code> in <code><a href="../reference/impute_new.html">impute_new()</a></code>. This value must be less
than or equal to the <code>m</code> used in <code><a href="../reference/mixgb.html">mixgb()</a></code>. If not
specified, <code><a href="../reference/impute_new.html">impute_new()</a></code> will use the <code>m</code> value
stored in the saved imputer object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_new.html">impute_new</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">mixgb_obj</span>, newdata <span class="op">=</span> <span class="va">test_data</span>,</span>
<span>  initial.newdata <span class="op">=</span> <span class="cn">FALSE</span>, pmm.k <span class="op">=</span> <span class="fl">3</span>, m <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yongshi Deng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
