<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mixgb">
<title>mixgb: Multiple Imputation Through XGBoost • mixgb</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mixgb: Multiple Imputation Through XGBoost">
<meta property="og:description" content="mixgb">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mixgb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/mixgb-vignette.html">mixgb: Multiple Imputation Through XGBoost</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/agnesdeng/mixgb/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="mixgb-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>mixgb: Multiple Imputation Through XGBoost</h1>
                        <h4 data-toc-skip class="author">Agnes Yongshi Deng</h4>
            
            <h4 data-toc-skip class="date">2022-05-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/agnesdeng/mixgb/blob/HEAD/vignettes/mixgb-vignette.Rmd" class="external-link"><code>vignettes/mixgb-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>mixgb-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
</div>
<div class="section level2">
<h2 id="imputing-missing-values-with-mixgb">Imputing missing values with <code>mixgb</code><a class="anchor" aria-label="anchor" href="#imputing-missing-values-with-mixgb"></a>
</h2>
<p>We first load the <code>mixgb</code> package and the <code>nhanes3_newborn</code> dataset, which contains 16 variables of various types (integer/numeric/factor/ordinal factor). There are 9 variables with missing values.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/agnesdeng/mixgb" class="external-link">mixgb</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nhanes3_newborn</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">nhanes3_newborn</span><span class="op">)</span>
<span class="co">#&gt; tibble [2,107 × 16] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;  $ HSHSIZER: int [1:2107] 4 3 5 4 4 3 5 3 3 3 ...</span>
<span class="co">#&gt;  $ HSAGEIR : int [1:2107] 2 5 10 10 8 3 10 7 2 7 ...</span>
<span class="co">#&gt;  $ HSSEX   : Factor w/ 2 levels "1","2": 2 1 2 2 1 1 2 2 2 1 ...</span>
<span class="co">#&gt;  $ DMARACER: Factor w/ 3 levels "1","2","3": 1 1 2 1 1 1 2 1 2 2 ...</span>
<span class="co">#&gt;  $ DMAETHNR: Factor w/ 3 levels "1","2","3": 3 1 3 3 3 3 3 3 3 3 ...</span>
<span class="co">#&gt;  $ DMARETHN: Factor w/ 4 levels "1","2","3","4": 1 3 2 1 1 1 2 1 2 2 ...</span>
<span class="co">#&gt;  $ BMPHEAD : num [1:2107] 39.3 45.4 43.9 45.8 44.9 42.2 45.8 NA 40.2 44.5 ...</span>
<span class="co">#&gt;   ..- attr(*, "label")= chr "Head circumference (cm)"</span>
<span class="co">#&gt;  $ BMPRECUM: num [1:2107] 59.5 69.2 69.8 73.8 69 61.7 74.8 NA 64.5 70.2 ...</span>
<span class="co">#&gt;   ..- attr(*, "label")= chr "Recumbent length (cm)"</span>
<span class="co">#&gt;  $ BMPSB1  : num [1:2107] 8.2 13 6 8 8.2 9.4 5.2 NA 7 5.9 ...</span>
<span class="co">#&gt;   ..- attr(*, "label")= chr "First subscapular skinfold (mm)"</span>
<span class="co">#&gt;  $ BMPSB2  : num [1:2107] 8 13 5.6 10 7.8 8.4 5.2 NA 7 5.4 ...</span>
<span class="co">#&gt;   ..- attr(*, "label")= chr "Second subscapular skinfold (mm)"</span>
<span class="co">#&gt;  $ BMPTR1  : num [1:2107] 9 15.6 7 16.4 9.8 9.6 5.8 NA 11 6.8 ...</span>
<span class="co">#&gt;   ..- attr(*, "label")= chr "First triceps skinfold (mm)"</span>
<span class="co">#&gt;  $ BMPTR2  : num [1:2107] 9.4 14 8.2 12 8.8 8.2 6.6 NA 10.9 7.6 ...</span>
<span class="co">#&gt;   ..- attr(*, "label")= chr "Second triceps skinfold (mm)"</span>
<span class="co">#&gt;  $ BMPWT   : num [1:2107] 6.35 9.45 7.15 10.7 9.35 7.15 8.35 NA 7.35 8.65 ...</span>
<span class="co">#&gt;   ..- attr(*, "label")= chr "Weight (kg)"</span>
<span class="co">#&gt;  $ DMPPIR  : num [1:2107] 3.186 1.269 0.416 2.063 1.464 ...</span>
<span class="co">#&gt;   ..- attr(*, "label")= chr "Poverty income ratio"</span>
<span class="co">#&gt;  $ HFF1    : Factor w/ 2 levels "1","2": 2 2 1 1 1 2 2 1 2 1 ...</span>
<span class="co">#&gt;  $ HYD1    : Ord.factor w/ 5 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 1 3 1 1 1 1 1 1 2 1 ...</span>
<span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">nhanes3_newborn</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; HSHSIZER  HSAGEIR    HSSEX DMARACER DMAETHNR DMARETHN  BMPHEAD BMPRECUM </span>
<span class="co">#&gt;        0        0        0        0        0        0      124      114 </span>
<span class="co">#&gt;   BMPSB1   BMPSB2   BMPTR1   BMPTR2    BMPWT   DMPPIR     HFF1     HYD1 </span>
<span class="co">#&gt;      161      169      124      167      117      192        7        0</span></code></pre></div>
<p>To impute this dataset, first we need to set up an Mixgb imputer with our choice of settings or leave it as default. Note that we do not need to convert our data into dgCMatrix or one-hot coding format. Our package will convert it automatically. Variables should be of the following types: numeric, integer, factor or ordinal factor. Except <code>data</code>, Other arguments in <code>Mixgb$new( )</code> are either hyperparameters or verbose settings for XGBoost training.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#default</span>
<span class="va">MIXGB</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Mixgb.html">Mixgb</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nhanes3_newborn</span><span class="op">)</span>

<span class="co">#with chosen settings</span>
<span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_depth <span class="op">=</span> <span class="fl">6</span>, 
              gamma <span class="op">=</span> <span class="fl">0.1</span>, 
              eta <span class="op">=</span> <span class="fl">0.3</span>, 
              min_child_weight <span class="op">=</span> <span class="fl">1</span>, 
              subsample <span class="op">=</span> <span class="fl">1</span>, 
              colsample_bytree <span class="op">=</span> <span class="fl">1</span>, 
              colsample_bylevel <span class="op">=</span> <span class="fl">1</span>, 
              colsample_bynode<span class="op">=</span><span class="fl">1</span>, 
              nthread <span class="op">=</span> <span class="fl">4</span>, 
              tree_method <span class="op">=</span> <span class="st">"auto"</span>, 
              gpu_id <span class="op">=</span> <span class="fl">0</span>, 
              predictor <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span>

<span class="va">MIXGB</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Mixgb.html">Mixgb</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nhanes3_newborn</span>, xgb.params <span class="op">=</span> <span class="va">params</span>, nrounds <span class="op">=</span> <span class="fl">100</span>, early_stopping_rounds <span class="op">=</span> <span class="fl">1</span>, print_every_n <span class="op">=</span> <span class="fl">1</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="tuning-hyperparameters">Tuning hyperparameters<a class="anchor" aria-label="anchor" href="#tuning-hyperparameters"></a>
</h3>
<p>Imputation performance can be affected by the Hyperparameters settings. It may seems daunting to tune a large set of hyperparameters, but most of the time, we can narrow down the search as many hyperparameters are correlated. There is no default <code>nrounds</code> value in <code>XGBoost</code> and users need to specify it. In our package <code>mixgb</code>, we set the default <code>nrounds</code> to be 50. However, we recommend users to use <code><a href="../reference/mixgb_cv.html">mixgb_cv()</a></code> to find the optimal <code>nrounds</code> first.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">optimal.nrounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixgb_cv.html">mixgb_cv</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nhanes3_newborn</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">optimal.nrounds</span><span class="op">$</span><span class="va">evaluation.log</span>
<span class="co">#&gt;     iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std</span>
<span class="co">#&gt;  1:    1      30.4116673    0.015188069      30.409707    0.07777879</span>
<span class="co">#&gt;  2:    2      21.3285197    0.010507943      21.327292    0.07291922</span>
<span class="co">#&gt;  3:    3      14.9724188    0.006790512      14.970697    0.06260375</span>
<span class="co">#&gt;  4:    4      10.5282752    0.004655272      10.528336    0.05932414</span>
<span class="co">#&gt;  5:    5       7.4259728    0.003501770       7.430070    0.05105283</span>
<span class="co">#&gt;  6:    6       5.2689467    0.003770056       5.278183    0.04582965</span>
<span class="co">#&gt;  7:    7       3.7767374    0.005179664       3.793598    0.04691414</span>
<span class="co">#&gt;  8:    8       2.7557338    0.005678957       2.796666    0.04979661</span>
<span class="co">#&gt;  9:    9       2.0665552    0.007261796       2.138057    0.04827493</span>
<span class="co">#&gt; 10:   10       1.6085964    0.005019828       1.724578    0.05383667</span>
<span class="co">#&gt; 11:   11       1.3094269    0.006692416       1.474514    0.05555110</span>
<span class="co">#&gt; 12:   12       1.1161416    0.006999592       1.333130    0.06094322</span>
<span class="co">#&gt; 13:   13       0.9978609    0.010222101       1.256955    0.06600090</span>
<span class="co">#&gt; 14:   14       0.9162444    0.012286595       1.218254    0.06359061</span>
<span class="co">#&gt; 15:   15       0.8660406    0.009820373       1.200724    0.06634997</span>
<span class="co">#&gt; 16:   16       0.8318048    0.014874714       1.192494    0.06747813</span>
<span class="co">#&gt; 17:   17       0.8028980    0.018304439       1.191796    0.06950947</span>
<span class="co">#&gt; 18:   18       0.7829723    0.023125482       1.190615    0.06914874</span>
<span class="co">#&gt; 19:   19       0.7635271    0.022083955       1.190263    0.07063192</span>
<span class="co">#&gt; 20:   20       0.7391095    0.025881326       1.193964    0.07051705</span>
<span class="co">#&gt; 21:   21       0.7162507    0.032581959       1.197489    0.07403246</span>
<span class="co">#&gt; 22:   22       0.7023509    0.026857057       1.197212    0.07261105</span>
<span class="co">#&gt; 23:   23       0.6838035    0.020044287       1.203384    0.07419674</span>
<span class="co">#&gt; 24:   24       0.6670833    0.020897203       1.205449    0.07365644</span>
<span class="co">#&gt; 25:   25       0.6502386    0.020705721       1.207824    0.07605898</span>
<span class="co">#&gt; 26:   26       0.6302469    0.024183077       1.210369    0.07824167</span>
<span class="co">#&gt; 27:   27       0.6188542    0.018582925       1.210740    0.07957250</span>
<span class="co">#&gt; 28:   28       0.6060847    0.012999665       1.212089    0.07909532</span>
<span class="co">#&gt; 29:   29       0.5942154    0.013886104       1.215368    0.08034233</span>
<span class="co">#&gt;     iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std</span>
<span class="va">optimal.nrounds</span><span class="op">$</span><span class="va">best.nrounds</span>
<span class="co">#&gt; [1] 19</span></code></pre></div>
<p>By default, <code><a href="../reference/mixgb_cv.html">mixgb_cv()</a></code> will randomly choose an incomplete variable as the response and build an XGBoost model with other variables using the complete cases of the dataset. Therefore, each run of <code><a href="../reference/mixgb_cv.html">mixgb_cv()</a></code> are likely to return different results. Users can also specify the response and covariates in the argument <code>response</code> and <code>select_covariates</code>, respectively.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">optimal.nrounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixgb_cv.html">mixgb_cv</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nhanes3_newborn</span>, nfold <span class="op">=</span> <span class="fl">10</span>, nrounds <span class="op">=</span> <span class="fl">100</span>, early_stopping_rounds <span class="op">=</span> <span class="fl">1</span>, response <span class="op">=</span> <span class="st">"BMPHEAD"</span>, select_covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HSHSIZER"</span>,<span class="st">"HSAGEIR"</span>, <span class="st">"HSSEX"</span>, <span class="st">"DMARETHN"</span>, <span class="st">"BMPRECUM"</span>, <span class="st">"BMPSB1"</span>, <span class="st">"BMPSB2"</span>, <span class="st">"BMPTR1"</span>, <span class="st">"BMPTR2"</span>  , <span class="st">"BMPWT"</span>, <span class="st">"DMPPIR"</span>, <span class="st">"HFF1"</span>, <span class="st">"HYD1"</span><span class="op">)</span>,verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">optimal.nrounds</span><span class="op">$</span><span class="va">best.nrounds</span>
<span class="co">#&gt; [1] 19</span></code></pre></div>
<p>Since the results returned by <code><a href="../reference/mixgb_cv.html">mixgb_cv()</a></code> are mostly less than 20, I’ll set <code>nrounds = 20</code> in the imputer.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MIXGB</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Mixgb.html">Mixgb</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nhanes3_newborn</span>, nrounds <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></code></pre></div>
<p>We now use this imputer to obtain m imputed datasets, which will be stored in a list of <code>m</code> data tables. If <code>m = 1</code>, single imputation will be undertaken. Users can also specify the number of imputation iterations <code>maxit</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imputed.data</span> <span class="op">&lt;-</span> <span class="va">MIXGB</span><span class="op">$</span><span class="fu">impute</span><span class="op">(</span>m <span class="op">=</span> <span class="fl">5</span>, maxit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; mixgb with bootstrap: imputing set -- 1 -- 2 -- 3 -- 4 -- 5</span></code></pre></div>
<p>We can also customise other imputation settings:</p>
<ul>
<li><p>Whether to use bootstrapping</p></li>
<li><p>The types of predictive mean matching</p></li>
<li><p>The number of donors for predictive mean matching</p></li>
<li><p>Whether to convert ordinal factors to integer ( imputation process will be faster)</p></li>
<li><p>Initial imputation methods</p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imputed.data</span> <span class="op">&lt;-</span> <span class="va">MIXGB</span><span class="op">$</span><span class="fu">impute</span><span class="op">(</span>m <span class="op">=</span> <span class="fl">5</span>, maxit <span class="op">=</span> <span class="fl">1</span>,  bootstrap <span class="op">=</span> <span class="cn">TRUE</span>,
                             pmm.type <span class="op">=</span> <span class="st">"auto"</span>, pmm.k <span class="op">=</span> <span class="fl">5</span>, 
                             ordinalAsInteger <span class="op">=</span> <span class="cn">TRUE</span>,
                            initial.num <span class="op">=</span> <span class="st">"normal"</span>, initial.int <span class="op">=</span> <span class="st">"sample"</span>, initial.fac <span class="op">=</span> <span class="st">"mode"</span><span class="op">)</span>
<span class="co">#&gt; mixgb with bootstrap: imputing set -- 1 -- 2 -- 3 -- 4 -- 5</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="convert-ordinal-factors-to-integers">Convert ordinal factors to integers<a class="anchor" aria-label="anchor" href="#convert-ordinal-factors-to-integers"></a>
</h3>
<p>If our dataset has a decent amount of ordinal factors, imputation process will speed up if we convert them to integers. In <code>nhanes3_newborn</code> data, there is only one ordinal factor, but we can still see that the imputation time is smaller with <code>ordinalAsInteger = TRUE</code>. If <code>m</code> and <code>maxit</code> are larger, the difference will be even more obvious. Note that when <code>ordinalAsInteger = TRUE</code> , the class of these ordinal factors in the imputed datasets will also be integer. We recommend to use the default PMM setting <code>pmm.type = "auto"</code>, which will impute numeric and integer variables with PMM (type 2) and impute categorical variables without PMM. If we don’t apply PMM to integer variables, the missing values may be imputed as numeric. Sometimes this can be problematic, especially when the integers are actually converted from ordinal factors. Therefore, <code>pmm.type = NULL</code> is disabled when <code>ordinalAsInteger = TRUE</code> .</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">imputed.data</span> <span class="op">&lt;-</span> <span class="va">MIXGB</span><span class="op">$</span><span class="fu">impute</span><span class="op">(</span>m <span class="op">=</span> <span class="fl">5</span>, maxit <span class="op">=</span> <span class="fl">1</span>,ordinalAsInteger <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; mixgb with bootstrap: imputing set -- 1 -- 2 -- 3 -- 4 -- 5</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   6.683   0.988   6.202</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">imputed.data</span> <span class="op">&lt;-</span> <span class="va">MIXGB</span><span class="op">$</span><span class="fu">impute</span><span class="op">(</span>m <span class="op">=</span> <span class="fl">5</span>, maxit <span class="op">=</span> <span class="fl">1</span>,ordinalAsInteger <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; mixgb with bootstrap: imputing set -- 1 -- 2 -- 3 -- 4 -- 5</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   6.284   0.980   5.907</span></code></pre></div>
<p>After imputing, we can have a look at the imputed values for an variable of interest. For example, here are 5 imputed sets of the missing values of the variable <code>BMPHEAD</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imputed.BMPHEAD</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/imputed_var.html">imputed_var</a></span><span class="op">(</span>imputation.list <span class="op">=</span> <span class="va">imputed.data</span>, var.name <span class="op">=</span> <span class="st">"BMPHEAD"</span>, original.data <span class="op">=</span> <span class="va">nhanes3_newborn</span><span class="op">)</span>
<span class="va">imputed.BMPHEAD</span>
<span class="co">#&gt;        m1   m2   m3   m4   m5</span>
<span class="co">#&gt;   1: 43.8 41.6 41.0 43.8 42.0</span>
<span class="co">#&gt;   2: 41.8 42.1 39.9 41.3 39.2</span>
<span class="co">#&gt;   3: 43.2 42.8 43.8 43.2 43.2</span>
<span class="co">#&gt;   4: 43.2 42.0 42.7 42.8 40.9</span>
<span class="co">#&gt;   5: 46.2 46.2 45.2 46.1 45.9</span>
<span class="co">#&gt;  ---                         </span>
<span class="co">#&gt; 120: 46.0 45.6 46.0 44.1 44.0</span>
<span class="co">#&gt; 121: 44.8 42.8 45.5 45.9 47.3</span>
<span class="co">#&gt; 122: 41.8 40.3 39.5 42.1 42.9</span>
<span class="co">#&gt; 123: 42.7 42.6 43.8 43.9 43.8</span>
<span class="co">#&gt; 124: 41.0 44.5 43.9 46.1 43.0</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="impute-new-unseen-data-using-a-trained-imputer">Impute new unseen data using a trained imputer<a class="anchor" aria-label="anchor" href="#impute-new-unseen-data-using-a-trained-imputer"></a>
</h2>
<p>First we can split the <code>nhanes3_newborn</code> dataset into training data and test data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nhanes3_newborn</span><span class="op">)</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">0.7</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">train.data</span> <span class="op">&lt;-</span> <span class="va">nhanes3_newborn</span><span class="op">[</span><span class="va">idx</span>, <span class="op">]</span>
<span class="va">test.data</span> <span class="op">&lt;-</span> <span class="va">nhanes3_newborn</span><span class="op">[</span><span class="op">-</span><span class="va">idx</span>, <span class="op">]</span></code></pre></div>
<p>We can use the training data to obtain <code>m</code> imputed datasets and save their imputation models. To achieve this, users need to set <code>save.models = TRUE</code>. By default <code>save.vars = NULL</code>, imputation models for variables with missing data in the training data will be saved. However, the unseen data may also have missing values in other variables, it would be comprehensive to save models for all variables by setting <code>save.vars = colnames(train.data)</code>. Note that this would take much longer time as we need to train and save a model for each variable. If users are confident that only certain variables will have missing values in the new data, we recommend to specify the names or indices of these variables in <code>save.vars</code> instead of saving models for all variables.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MIXGB</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Mixgb.html">Mixgb</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="va">train.data</span><span class="op">)</span>
<span class="va">mixgb.obj</span> <span class="op">&lt;-</span> <span class="va">MIXGB</span><span class="op">$</span><span class="fu">impute</span><span class="op">(</span>m <span class="op">=</span> <span class="fl">5</span>, maxit <span class="op">=</span> <span class="fl">1</span>, save.models <span class="op">=</span> <span class="cn">TRUE</span>, save.vars <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="co">#&gt; mixgb with bootstrap: saving models and imputing set -- 1 -- 2 -- 3 -- 4 -- 5</span></code></pre></div>
<p>We can extract <code>m</code> imputed datasets from the saved imputer object by <code>$imputed.data</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imputed.traindata</span> <span class="op">&lt;-</span> <span class="va">mixgb.obj</span><span class="op">$</span><span class="va">imputed.data</span>
<span class="co">#the 5th imputed dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">imputed.traindata</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;    HSHSIZER HSAGEIR HSSEX DMARACER DMAETHNR DMARETHN BMPHEAD BMPRECUM BMPSB1</span>
<span class="co">#&gt; 1:        7       2     1        1        1        3    42.4     66.7    7.8</span>
<span class="co">#&gt; 2:        4       3     2        2        3        2    42.6     67.1    8.8</span>
<span class="co">#&gt; 3:        3       9     2        2        3        2    46.5     64.3    8.6</span>
<span class="co">#&gt; 4:        3       9     2        1        3        1    46.2     68.5   10.8</span>
<span class="co">#&gt; 5:        5       4     1        1        3        1    44.7     63.0    6.0</span>
<span class="co">#&gt; 6:        5      10     1        1        3        1    45.2     72.0    5.4</span>
<span class="co">#&gt;    BMPSB2 BMPTR1 BMPTR2 BMPWT DMPPIR HFF1 HYD1</span>
<span class="co">#&gt; 1:    8.0    8.8    9.5  7.60  1.701    2    1</span>
<span class="co">#&gt; 2:    8.8   13.3   12.2  8.70  0.102    2    1</span>
<span class="co">#&gt; 3:    8.0   10.4    9.2  8.00  0.359    1    3</span>
<span class="co">#&gt; 4:   10.0   16.6   16.0  8.98  0.561    1    3</span>
<span class="co">#&gt; 5:    5.8    9.0    9.0  7.60  2.379    2    1</span>
<span class="co">#&gt; 6:    5.4    9.2    9.4  9.00  2.173    2    2</span></code></pre></div>
<p>To impute new data with this saved imputer object, we use the <code><a href="../reference/impute_new.html">impute_new()</a></code> function. User can also specify whether to use new data for initial imputation. By default, <code>initial.newdata = FALSE</code>, we will use the information of training data to initially impute the new data. New data will be imputed with the saved models. This process will be considerably fast as we don’t need to build the imputation models again.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imputed.testdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_new.html">impute_new</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">mixgb.obj</span>, newdata <span class="op">=</span> <span class="va">test.data</span><span class="op">)</span> 
<span class="co">#&gt; Imputing new data with mixgb:  set -- 1 -- 2 -- 3 -- 4 -- 5</span></code></pre></div>
<p>If PMM is used in the trained imputer, predicted values of missing entries in the new dataset are matched with training data. Users can also set the number of donors for PMM when imputing new data. By default, <code>pmm.k = NULL</code> , which means the same setting as the training object will be used.</p>
<p>Similarly, users can set the number of imputed datasets <code>m</code>. Note that this value has to be smaller than or equal to the one set in the trained imputer. If it is not specified, it will use the same <code>m</code> value as the trained imputer.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">imputed.testdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_new.html">impute_new</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">mixgb.obj</span>, newdata <span class="op">=</span> <span class="va">test.data</span>, initial.newdata <span class="op">=</span> <span class="cn">FALSE</span>, pmm.k <span class="op">=</span> <span class="fl">3</span>, m <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; Imputing new data with mixgb:  set -- 1 -- 2 -- 3 -- 4</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Yongshi Deng.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
